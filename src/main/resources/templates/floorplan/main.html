<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>학교 평면도 관리 - I-NET</title>
    <link rel="stylesheet" href="/main.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* 평면도 관리 전용 스타일 */
        .floorplan-page {
            background: #f5f5f5;
        }

        .floorplan-container {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            padding: 2rem 0;
            margin-bottom: 2rem;
        }

        .floorplan-wrapper {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 1rem;
        }

        .main-wrapper {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .floorplan-header {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            padding: 3rem 2rem;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .floorplan-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200"><defs><pattern id="hexagon" width="50" height="43.4" patternUnits="userSpaceOnUse"><polygon points="25,2 45,14.5 45,29.5 25,42 5,29.5 5,14.5" fill="none" stroke="rgba(255,255,255,0.08)" stroke-width="1"/></pattern></defs><rect width="200" height="200" fill="url(%23hexagon)"/></svg>');
            animation: patternFloat 30s ease-in-out infinite;
            z-index: 0;
        }

        .floorplan-header::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 20% 30%, rgba(255,255,255,0.1) 2px, transparent 2px),
                        radial-gradient(circle at 80% 70%, rgba(255,255,255,0.08) 1.5px, transparent 1.5px),
                        radial-gradient(circle at 40% 80%, rgba(255,255,255,0.06) 1px, transparent 1px);
            background-size: 60px 60px, 40px 40px, 80px 80px;
            animation: floatingDots 25s linear infinite;
            z-index: 0;
        }

        @keyframes patternFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        @keyframes floatingDots {
            0% { transform: translate(0, 0); }
            100% { transform: translate(20px, 20px); }
        }

        .header-icon {
            background: rgba(255, 255, 255, 0.2);
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1.5rem;
            font-size: 2rem;
            position: relative;
            z-index: 1;
        }

        .floorplan-header h1 {
            margin: 0 0 0.5rem;
            font-size: 2.5rem;
            font-weight: 800;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            position: relative;
            z-index: 1;
        }

        .floorplan-header p {
            margin: 0;
            font-size: 1.1rem;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        /* 학교 선택 */
        .school-selector {
            padding: 2rem;
            border-bottom: 1px solid #e5e7eb;
        }

        .school-selector h3 {
            margin: 0 0 1rem;
            color: #374151;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.2rem;
        }

        .school-select {
            width: 100%;
            padding: 1rem;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 1rem;
            background: white;
            transition: all 0.3s ease;
        }

        .school-select:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        /* 모드 전환 탭 */
        .mode-tabs {
            background: #f8fafc;
            padding: 0 2rem;
        }

        .tab-buttons {
            display: flex;
            gap: 0;
            flex-wrap: wrap;
        }

        .tab-button {
            background: none;
            border: none;
            padding: 1.2rem 1.5rem;
            cursor: pointer;
            color: #6b7280;
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            flex: 1;
            min-width: 0;
            text-align: center;
            justify-content: center;
        }

        .tab-button.active {
            color: #3b82f6;
            border-bottom-color: #3b82f6;
            background: white;
            margin-bottom: -1px;
        }

        .tab-button:hover:not(.active) {
            color: #374151;
            background: rgba(255, 255, 255, 0.5);
        }

        /* 도구모음 */
        .toolbar {
            display: none;
            padding: 1.5rem 2rem;
            background: white;
            border-bottom: 1px solid #e5e7eb;
            gap: 1rem;
            flex-wrap: wrap;
            transition: all 0.3s ease;
        }

        .toolbar.active {
            display: flex;
            align-items: center;
        }

        /* 스크롤 시 고정되는 상태 */
        .toolbar.fixed {
            position: fixed;
            top: 60px; /* 네비바 높이 */
            left: 0;
            right: 0;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .tool-group {
            display: flex;
            gap: 0.5rem;
            padding: 0.5rem;
            background: #f8fafc;
            border-radius: 10px;
            flex-wrap: wrap;
            align-items: center;
        }

        .tool-button {
            background: white;
            border: 1px solid #e5e7eb;
            padding: 0.75rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            color: #374151;
            font-size: 0.8rem;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            white-space: nowrap;
            min-width: 100px;
            justify-content: center;
            height: 40px;
        }

        .tool-button:hover {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }

        .tool-button.active {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }

        /* 캔버스 영역 */
        .canvas-container {
            position: relative;
            margin-left: 0;
            transition: all 0.3s ease;
            padding: 2rem;
            background: #f8fafc;
            overflow: visible;
            border: 2px solid #ddd;
            border-radius: 8px;
            min-height: 600px;
        }

        .canvas-area {
            background: white;
            border: 2px dashed #d1d5db;
            border-radius: 15px;
            min-height: 500px;
            position: relative;
            overflow: hidden;
        }

        .canvas-content {
            /* 좌측 패널이 접힌 기본 상태 */
            box-sizing: border-box;
            margin-left: 60px;
            width: calc(100% - 60px); /* margin 과 합쳐 100% 유지 */
            transition: margin-left 0.3s ease;
            position: relative;
            min-height: 500px;
            background: #ffffff;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            overflow: visible;
            z-index: 1;
            cursor: crosshair;
            user-select: none;
        }

        .canvas-content {
            width: 100%;
            height: 100%;
            min-height: 500px;
            position: relative;
            background-image: 
                linear-gradient(rgba(59, 130, 246, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(59, 130, 246, 0.1) 1px, transparent 1px);
            background-size: 20px 20px;
        }

        /* 도구별 커서 스타일 */
        .canvas-content[data-tool="building"],
        .canvas-content[data-tool="room"],
        .canvas-content[data-tool="other-space"],
        .canvas-content[data-tool="add-ap"],
        .canvas-content[data-tool="shape"] {
            cursor: crosshair !important;
        }
        
        .canvas-content[data-tool="delete"] {
            cursor: not-allowed !important;
        }

        /* 저장 섹션 */
        .save-section {
            padding: 2rem;
            background: #f8fafc;
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .save-button, .download-button {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border: none;
            padding: 1rem 1.5rem;
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }

        .download-button {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);
        }

        .save-button:hover, .download-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.4);
        }

        .download-button:hover {
            box-shadow: 0 8px 25px rgba(245, 158, 11, 0.4);
        }

        /* 드래그 가능한 요소들 */
        .draggable {
            position: absolute;
            cursor: move;
            transition: all 0.3s ease;
        }

        /* 선 타입 도형을 제외한 요소에만 테두리 적용 */
        .draggable:not(.shape-line):not(.shape-arrow):not(.shape-dashed) {
            border: 2px solid transparent;
        }

        .draggable:hover {
            border-color: #3b82f6;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }

        /* 선 타입 도형의 hover 스타일 */
        .shape-line:hover, .shape-arrow:hover, .shape-dashed:hover {
            box-shadow: 0 0 0 2px #3b82f6;
        }

        .draggable.selected {
            border-color: #ef4444;
            box-shadow: 0 4px 20px rgba(239, 68, 68, 0.4);
        }

        /* 선 타입 도형의 selected 스타일 */
        .shape-line.selected, .shape-arrow.selected, .shape-dashed.selected {
            box-shadow: 0 0 0 2px #ef4444;
        }

        /* 다중 선택된 요소 스타일 */
        .draggable.multi-selected {
            border-color: #10b981;
            box-shadow: 0 4px 20px rgba(16, 185, 129, 0.4);
            background: rgba(16, 185, 129, 0.1);
        }

        /* 선 타입 도형의 multi-selected 스타일 */
        .shape-line.multi-selected, .shape-arrow.multi-selected, .shape-dashed.multi-selected {
            box-shadow: 0 0 0 2px #10b981;
        }

        /* 선택 박스 스타일 */
        .selection-box {
            border: 2px dashed #3b82f6 !important;
            background: rgba(59, 130, 246, 0.1) !important;
            pointer-events: none !important;
            z-index: 9999 !important;
        }

        /* 다중 선택 정보 표시 */
        .multi-select-info {
            position: fixed;
            top: 80px;
            right: 20px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 500;
            z-index: 10000;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            opacity: 0;
            transform: translateX(400px);
            transition: all 0.3s ease;
        }

        .multi-select-info.show {
            opacity: 1;
            transform: translateX(0);
        }

        /* 크기 조절 핸들 */
        .resize-handles {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .draggable:hover .resize-handles {
            opacity: 1;
        }

        .resize-handle {
            position: absolute;
            background: #3b82f6;
            border: 1px solid #fff;
            width: 8px;
            height: 8px;
            border-radius: 2px;
            pointer-events: auto;
            z-index: 10;
        }

        .resize-handle.nw { top: -4px; left: -4px; cursor: nw-resize; }
        .resize-handle.ne { top: -4px; right: -4px; cursor: ne-resize; }
        .resize-handle.sw { bottom: -4px; left: -4px; cursor: sw-resize; }
        .resize-handle.se { bottom: -4px; right: -4px; cursor: se-resize; }
        .resize-handle.n { top: -4px; left: 50%; transform: translateX(-50%); cursor: n-resize; }
        .resize-handle.s { bottom: -4px; left: 50%; transform: translateX(-50%); cursor: s-resize; }
        .resize-handle.w { top: 50%; left: -4px; transform: translateY(-50%); cursor: w-resize; }
        .resize-handle.e { top: 50%; right: -4px; transform: translateY(-50%); cursor: e-resize; }

        /* 충돌 방지 시각적 피드백 */
        .collision-warning {
            border: 2px solid #ef4444 !important;
            box-shadow: 0 0 10px rgba(239, 68, 68, 0.5) !important;
            animation: shake 0.3s ease-in-out;
        }

        /* 선 타입 도형의 충돌 경고 스타일 */
        .shape-line.collision-warning, .shape-arrow.collision-warning, .shape-dashed.collision-warning {
            box-shadow: 0 0 0 2px #ef4444, 0 0 10px rgba(239, 68, 68, 0.5) !important;
            border: none !important;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-2px); }
            75% { transform: translateX(2px); }
        }

        /* 정렬 가이드라인 */
        .alignment-guide {
            position: absolute;
            background: #3b82f6;
            pointer-events: none;
            z-index: 999;
            opacity: 0.7;
        }

        .alignment-guide.vertical {
            width: 1px;
            height: 100%;
            top: 0;
        }

        .alignment-guide.horizontal {
            height: 1px;
            width: 100%;
            left: 0;
        }

        /* 요소 간 최소 간격 표시 */
        .safe-zone {
            position: absolute;
            border: 1px dashed rgba(16, 185, 129, 0.3);
            background: rgba(16, 185, 129, 0.1);
            pointer-events: none;
            z-index: 1;
        }

        /* 건물 스타일 */
        .building {
            background: transparent;
            border: 2px solid #000;
            color: #000;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.9rem;
            position: relative;
        }

        /* 교실/방 스타일 */
        .room {
            background: transparent;
            border: 2px solid #000;
            color: #000;
            border-radius: 4px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            padding: 0.2rem;
            position: relative;
        }
        
        /* 기타공간 스타일 */
        .room[data-type="other-space"] {
            font-style: italic;
            color: #333;
        }

        .room-name {
            position: absolute;
            top: 40%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            font-weight: bold;
            pointer-events: none;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            width: 90%;
        }

        /* 교실 장비 아이콘 영역 */
        .room-devices {
            position: absolute;
            bottom: 3px;
            left: 4px;
            right: 4px;
            display: flex;
            flex-wrap: wrap;
            gap: 2px;
            line-height: 1;
            max-height: none; /* 다중 행 허용 */
            overflow: visible; /* hidden 대신 visible로 변경 */
            pointer-events: none;
            z-index: 10;
            padding: 0;
            align-items: flex-start;
            align-content: flex-start;
        }

        .device-icon {
            display: flex;
            align-items: center;
            font-size: 9px;
            color: #333;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 4px;
            padding: 2px 4px;
            white-space: nowrap;
            border: 1px solid rgba(0, 0, 0, 0.15);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12);
            height: 20px; /* 높이 증가 */
            min-width: 24px; /* 최소 너비 증가 */
            pointer-events: auto;
            flex-shrink: 0; /* 크기 유지 */
            backdrop-filter: blur(2px);
            transition: all 0.2s ease;
        }
        
        .device-icon:hover {
            background: rgba(255, 255, 255, 1);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
            transform: translateY(-1px);
        }
        
        .device-icon i {
            margin-right: 3px;
            font-size: 10px; /* 아이콘 크기 증가 */
            flex-shrink: 0;
        }
        
        /* 오버플로우 인디케이터 */
        .device-overflow {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 9px;
            color: #555;
            background: rgba(240, 240, 240, 0.95);
            border-radius: 4px;
            padding: 2px 6px;
            border: 1px solid rgba(0, 0, 0, 0.2);
            height: 20px;
            min-width: 28px;
            cursor: pointer;
            pointer-events: auto;
            flex-shrink: 0;
            font-weight: 600;
            backdrop-filter: blur(2px);
            transition: all 0.2s ease;
        }
        
        .device-overflow:hover {
            background: rgba(59, 130, 246, 0.9);
            color: white;
            transform: translateY(-1px);
            box-shadow: 0 2px 6px rgba(59, 130, 246, 0.3);
        }
        
        /* 장비 타입별 컬러 아이콘 */
        .device-icon.desktop i { color: #2563eb; } /* 파란색 - 데스크톱 */
        .device-icon.monitor i { color: #059669; } /* 녹색 - 모니터 */
        .device-icon.laptop i { color: #7c3aed; } /* 보라색 - 노트북 */
        .device-icon.printer i { color: #dc2626; } /* 빨간색 - 프린터 */
        .device-icon.projector i { color: #ea580c; } /* 주황색 - 프로젝터 */
        .device-icon.tv i { color: #be185d; } /* 핑크색 - TV */
        .device-icon.speaker i { color: #0891b2; } /* 청록색 - 스피커 */
        .device-icon.network i { color: #65a30d; } /* 라임색 - 네트워크 */
        .device-icon.default i { color: #6b7280; } /* 회색 - 기본 */
        
        .device-count {
            font-weight: 700;
            font-size: 10px; /* 크기 증가 */
            color: #1f2937;
            margin-left: 1px;
            text-shadow: 0 1px 1px rgba(255, 255, 255, 0.5);
        }
        
        /* 장비 상세 팝업 */
        .device-popup {
            position: fixed;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
            z-index: 2000;
            font-size: 13px;
            min-width: 160px;
            max-width: 250px;
            pointer-events: auto;
            backdrop-filter: blur(10px);
            animation: popupFadeIn 0.2s ease-out;
        }
        
        @keyframes popupFadeIn {
            from { 
                opacity: 0; 
                transform: translateY(-5px) scale(0.95); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0) scale(1); 
            }
        }
        
        .device-popup::before {
            content: '';
            position: absolute;
            top: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-bottom: 8px solid white;
            filter: drop-shadow(0 -2px 2px rgba(0, 0, 0, 0.1));
        }
        
        .device-popup-item {
            display: flex;
            align-items: center;
            padding: 4px 0;
            border-bottom: 1px solid #f3f4f6;
        }
        
        .device-popup-item:last-child {
            border-bottom: none;
        }
        
        .device-popup-item i {
            margin-right: 8px;
            width: 16px;
            font-size: 14px;
        }
        
        .device-popup-item span {
            font-weight: 500;
            color: #374151;
        }

        .device-icons {
            display: flex;
            gap: 0.2rem;
            flex-wrap: wrap;
            justify-content: center;
        }

        /* 무선AP */
        .wireless-ap {
            border-radius: 50%;
            background: #ef4444;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.7rem;
        }

        /* 알림 메시지 */
        .notification {
            position: fixed;
            top: 80px;
            right: 20px;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 10000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
            min-width: 300px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.info {
            background: linear-gradient(135deg, #1c93ca 0%, #0a7997 100%);
        }

        .notification.success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        .notification.error {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }

        .notification.warning {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        }

        /* 반응형 디자인 */
        @media (max-width: 1024px) {
            .floorplan-header h1 {
                font-size: 2rem;
            }
            
            .canvas-area {
                min-height: 400px;
            }
            
            .canvas-content {
                min-height: 400px;
            }
            
            .tool-button {
                font-size: 0.7rem;
                padding: 0.5rem 0.8rem;
            }
        }

        @media (max-width: 768px) {
            .floorplan-container {
                padding: 1rem 0;
            }
            
            .floorplan-wrapper {
                padding: 0 0.5rem;
            }
            
            .floorplan-header {
                padding: 2rem 1rem;
            }
            
            .floorplan-header h1 {
                font-size: 1.8rem;
            }
            
            .school-selector, .canvas-container, .save-section {
                padding: 1rem;
            }
            
            .tab-button {
                padding: 1rem 0.8rem;
                font-size: 0.8rem;
            }
            
            .tab-button i {
                display: none;
            }
            
            .toolbar {
                padding: 1rem;
            }
            
            .tool-group {
                flex: 1;
                justify-content: center;
            }
            
            .canvas-area {
                min-height: 300px;
            }
            
            .canvas-content {
                min-height: 300px;
            }
            
            .save-section {
                flex-direction: column;
                align-items: center;
            }
            
            .save-button, .download-button {
                width: 100%;
                max-width: 300px;
            }
        }

        /* 확대/축소 컨트롤 */
        .zoom-controls {
            position: absolute;
            top: 15px;
            right: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.95);
            padding: 8px 12px;
            border-radius: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            z-index: 900; /* 네비바(1000)보다 낮게 설정 */
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }

        .zoom-controls.fixed {
            position: fixed;
            top: 140px; /* 네비바(60px) + 도구모음 높이(약 80px) */
            right: 15px;
        }

        .zoom-btn {
            width: 32px;
            height: 32px;
            border: none;
            background: #007bff;
            color: white;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .zoom-btn:hover {
            background: #0056b3;
            transform: scale(1.05);
        }

        #zoomLevel {
            font-size: 12px;
            font-weight: 600;
            color: #333;
            min-width: 40px;
            text-align: center;
        }

        /* 캔버스 확대/축소 관련 */
        .canvas-content {
            position: relative;
            width: 100%;
            min-width: 100%;
            min-height: 500px;
            background: #ffffff !important; /* 강제로 흰색 배경 적용 */
            transform-origin: 0 0;
            transition: transform 0.3s ease;
            overflow: visible;
        }

        /* 확대/축소 시에도 배경색 유지 */
        .canvas-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #ffffff;
            z-index: -1;
        }

        /* 미배치 교실 패널 */
        .unplaced-rooms-panel {
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 250px;
            background: #ffffff;
            border-right: 2px solid #ddd;
            box-shadow: 2px 0 8px rgba(0, 0, 0, 0.1);
            z-index: 899; /* 네비바(1000)보다 낮게 설정 */
            transition: transform 0.3s ease;
            overflow: hidden;
            transform: translateX(0); /* 기본은 펼쳐진 상태 */
        }

        .unplaced-rooms-panel.fixed {
            position: fixed;
            top: 140px; /* 네비바(60px) + 도구모음 높이(약 80px) */
            bottom: 0;
        }

        /* 패널이 고정되었을 때 캔버스 마진 조정 */
        .unplaced-rooms-panel.fixed ~ .canvas-content,
        .unplaced-rooms-panel.fixed:not(.collapsed) ~ .canvas-content {
            margin-left: 270px; /* 패널 너비(250px) + 여백(20px) */
            width: calc(100% - 270px);
        }

        .unplaced-rooms-panel.fixed.collapsed ~ .canvas-content {
            margin-left: 60px; /* 기본값 유지 */
            width: calc(100% - 60px);
        }

        .unplaced-rooms-panel.collapsed {
            transform: translateX(-220px); /* collapsed 클래스가 있을 때만 숨김 */
        }

        .panel-toggle {
            position: absolute;
            left: 250px; /* 기본 위치는 펼쳐진 상태 */
            top: 15px;
            width: 30px;
            height: 30px;
            border: none;
            background: #007bff;
            color: white;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            transition: all 0.3s ease;
            z-index: 1001; /* 네비바와 동일하게 설정하여 모든 요소보다 위에 */
            box-shadow: 2px 0 8px rgba(0, 0, 0, 0.1);
        }

        .panel-toggle.fixed {
            position: fixed;
            top: 175px; /* 네비바(60px) + 도구모음 높이(약 80px) + 여유 공간(35px) */
            left: 250px; /* 명시적으로 left 값도 설정 */
        }

        .panel-toggle:hover {
            background: #0056b3;
            transform: scale(1.1);
        }

        /* 패널이 접혀있을 때 토글 버튼 위치 */
        .unplaced-rooms-panel.collapsed + .panel-toggle {
            left: 30px; /* 접힌 상태일 때 버튼 위치 */
        }

        /* 모바일에서 fixed 상태이면서 패널이 접혀있을 때 토글 버튼 위치 */
        .unplaced-rooms-panel.collapsed + .panel-toggle.fixed {
            left: 30px !important; /* 접힌 상태일 때는 고정된 위치에서도 왼쪽으로 */
        }

        .unplaced-rooms-panel:not(.collapsed) + .panel-toggle i {
            transform: rotate(180deg); /* 펼쳐진 상태에서 왼쪽 화살표 */
        }

        /* 캔버스 콘텐츠 영역 조정 (패널 펼쳐진 상태) */
        .canvas-content {
            box-sizing: border-box;
            margin-left: 280px; /* 패널 폭(250px)+여백(30px) */
            width: calc(100% - 280px);
            transition: margin-left 0.3s ease;
            position: relative;
            min-height: 500px;
            background: #ffffff;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            overflow: hidden;
            z-index: 1;
            cursor: crosshair;
            user-select: none;
        }

        .unplaced-rooms-panel.collapsed ~ .canvas-content {
            margin-left: 60px;
            width: calc(100% - 60px);
        }

        .panel-header {
            padding: 15px;
            background: #f8f9fa;
            border-bottom: 1px solid #e0e0e0;
        }

        .panel-header h4 {
            margin: 0;
            font-size: 14px;
            font-weight: 600;
            color: #333;
        }

        .panel-content {
            padding: 10px;
            height: calc(100% - 70px);
            overflow-y: auto;
        }

        .unplaced-room-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px;
            margin-bottom: 8px;
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            cursor: grab;
            transition: all 0.2s ease;
            user-select: none;
        }

        .unplaced-room-item:hover {
            background: #e3f2fd;
            border-color: #007bff;
            transform: translateX(2px);
        }

        .unplaced-room-item.dragging {
            opacity: 0.5;
            transform: rotate(2deg);
        }

        .unplaced-room-item:active {
            cursor: grabbing;
        }

        .room-info {
            flex: 1;
        }

        .unplaced-room-item .room-name {
            font-weight: 600;
            color: #333;
            font-size: 13px;
            position: static;
            transform: none;
        }

        .unplaced-room-item .room-details {
            font-size: 11px;
            color: #666;
            margin-top: 2px;
        }

        .drag-icon {
            color: #999;
            font-size: 12px;
        }

        /* 드래그 오버 효과 */
        .canvas-content.drag-over {
            background: rgba(0, 123, 255, 0.1) !important;
            border: 2px dashed #007bff;
        }

        /* 모바일 반응형 */
        @media (max-width: 768px) {
            .toolbar {
                top: 60px; /* 모바일에서는 도구모음이 더 얇을 수 있음 */
                padding: 1rem;
            }
            
            .zoom-controls {
                top: 120px; /* 네비바(60px) + 모바일 도구모음(약 60px) */
                right: 5px;
                padding: 3px 6px;
                gap: 3px;
            }

            .zoom-btn {
                width: 25px;
                height: 25px;
                font-size: 10px;
            }

            #zoomLevel {
                font-size: 10px;
                min-width: 30px;
            }
            
            .unplaced-rooms-panel {
                width: 200px;
                top: 120px; /* 네비바(60px) + 모바일 도구모음(약 60px) */
            }
            
            .panel-toggle {
                left: 200px; /* 모바일 패널 폭에 맞춤 */
                top: 15px; /* 패널 내부에서의 상대 위치 */
                z-index: 1001; /* 모든 요소보다 위에 */
            }

            .panel-toggle.fixed {
                top: 155px; /* 네비바(60px) + 모바일 도구모음(약 60px) + 여유 공간(35px) */
                left: 200px; /* 명시적으로 left 값도 설정 */
            }
            
            .unplaced-rooms-panel.collapsed + .panel-toggle {
                left: 30px; /* 접힌 상태일 때 버튼 위치 */
            }
            
            .canvas-content {
                margin-left: 230px; /* 모바일에서 패널 너비 조정 */
            }
            
            /* 모바일에서 패널이 고정되었을 때 캔버스 마진 조정 */
            .unplaced-rooms-panel.fixed ~ .canvas-content,
            .unplaced-rooms-panel.fixed:not(.collapsed) ~ .canvas-content {
                margin-left: 220px; /* 모바일 패널 너비(200px) + 여백(20px) */
                width: calc(100% - 220px);
            }

            .unplaced-rooms-panel.fixed.collapsed ~ .canvas-content {
                margin-left: 50px; /* 모바일 기본값 유지 */
                width: calc(100% - 50px);
            }
            
            .unplaced-rooms-panel.collapsed ~ .canvas-content {
                margin-left: 50px;
                width: calc(100% - 50px);
            }
        }

        /* 도구 드롭다운 스타일 */
        .tool-dropdown {
            position: relative;
            display: inline-block;
        }
        
        .dropdown-content {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            background-color: #fff;
            min-width: 180px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.15);
            z-index: 1000;
            border-radius: 8px;
            padding: 8px 0;
            margin-top: 5px;
            border: 1px solid #e5e7eb;
        }
        
        .dropdown-content.show {
            display: block;
        }
        
        .dropdown-item {
            display: flex;
            align-items: center;
            padding: 8px 15px;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
            cursor: pointer;
            font-size: 0.9rem;
            color: #333;
            transition: background-color 0.2s;
        }
        
        .dropdown-item:hover {
            background-color: #f3f4f6;
        }
        
        .dropdown-item i {
            margin-right: 8px;
            width: 16px;
        }
        
        /* 도형 스타일 관련 선택기 */
        .shape-select {
            background: white;
            border: 1px solid #e5e7eb;
            padding: 0.75rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            color: #374151;
            font-size: 0.65rem;
            font-weight: 500;
            transition: all 0.3s ease;
            margin-left: 0.5rem;
            height: 40px;
            min-width: 100px;
        }
        
        .shape-select:hover, .shape-select:focus {
            border-color: #3b82f6;
            outline: none;
        }
        
        /* 도형 스타일 클래스들 */
        .shape {
            position: absolute;
            pointer-events: auto;
            box-sizing: border-box; /* border-box로 설정 */
        }

        .shape-line {
            background-color: #000;
            transform-origin: left center;
            border: none !important; /* 테두리 없음 강제 적용 */
            outline: none !important; /* 외곽선 없음 강제 적용 */
            /* JavaScript에서 완전히 제어 */
        }

        .shape-dashed {
            transform-origin: left center;
            border: none !important; /* 테두리 없음 강제 적용 */
            outline: none !important; /* 외곽선 없음 강제 적용 */
            /* JavaScript에서 완전히 제어 */
        }

        .shape-curve {
            border: none;
        }

        .shape-arrow {
            background-color: #000;
            transform-origin: left center;
            border: none !important; /* 테두리 없음 강제 적용 */
            outline: none !important; /* 외곽선 없음 강제 적용 */
            /* JavaScript에서 완전히 제어 */
        }

        .shape-arrow::after {
            content: '';
            position: absolute;
            right: 0;
            /* top 위치는 JavaScript에서 동적으로 설정 */
            width: 0;
            height: 0;
            /* 화살표 스타일은 JavaScript에서 동적으로 설정 */
        }

        .shape-circle {
            border: 2px solid #000;
            border-radius: 50%;
        }

        .shape-rect {
            border: 2px solid #000;
        }

        .shape-arc {
            border: 2px solid #000;
            border-radius: 100% 0 0 0;
            border-right: none;
            border-bottom: none;
        }
    </style>
</head>
<body class="floorplan-page">
    <!-- 네비게이션 바 포함 -->
    <div th:replace="~{fragments/navbar :: navbar}"></div>

    <div class="floorplan-container">
        <div class="floorplan-wrapper">
            <div class="main-wrapper">
                <!-- 헤더 -->
                <div class="floorplan-header">
                    <div class="header-icon">
                        <i class="fas fa-building"></i>
                    </div>
                    <h1>학교 평면도 관리</h1>
                    <p>학교 건물과 교실 배치를 설계하고 장비 위치를 관리하세요</p>
                </div>

                <!-- 학교 선택 -->
                <div class="school-selector">
                    <h3><i class="fas fa-school"></i> 학교 선택</h3>
                    <select id="schoolSelect" class="school-select">
                        <option value="">학교를 선택하세요</option>
                        <option th:each="school : ${schools}" 
                                th:value="${school.schoolId}" 
                                th:text="${school.schoolName}"></option>
                    </select>
                </div>

                <!-- 모드 전환 탭 -->
                <div class="mode-tabs">
                    <div class="tab-buttons">
                        <button class="tab-button active" data-mode="layout">
                            <i class="fas fa-drafting-compass"></i> 평면도 설계
                        </button>
                        <button class="tab-button" data-mode="device">
                            <i class="fas fa-microchip"></i> 장비 배치
                        </button>
                        <button class="tab-button" data-mode="wireless">
                            <i class="fas fa-wifi"></i> 무선AP
                        </button>
                    </div>
                </div>

                <!-- 평면도 설계 도구 -->
                <div id="layoutToolbar" class="toolbar active">
                    <div class="tool-group">
                        <button class="tool-button" data-tool="select">
                            <i class="fas fa-mouse-pointer"></i> 선택
                        </button>
                        <button class="tool-button" data-tool="building">
                            <i class="fas fa-building"></i> 건물 추가
                        </button>
                        <button class="tool-button" data-tool="room">
                            <i class="fas fa-door-open"></i> 교실 추가
                        </button>
                        
                        <div class="tool-dropdown">
                            <button class="tool-button" data-tool="other-space" id="otherSpaceButton">
                                <i class="fas fa-building"></i> 기타공간
                                <i class="fas fa-caret-down"></i>
                            </button>
                            <div class="dropdown-content" id="otherSpaceDropdown">
                                <button class="dropdown-item" data-other-space="화장실">
                                    <i class="fas fa-toilet"></i> 화장실
                                </button>
                                <button class="dropdown-item" data-other-space="EV">
                                    <i class="fas fa-elevator"></i> EV
                                </button>
                                <button class="dropdown-item" data-other-space="현관">
                                    <i class="fas fa-door-open"></i> 현관
                                </button>
                            </div>
                        </div>
                        
                        <div class="tool-dropdown">
                            <button class="tool-button" data-tool="shape" id="shapeButton">
                                <i class="fas fa-shapes"></i> 도형
                                <i class="fas fa-caret-down"></i>
                            </button>
                            <div class="dropdown-content" id="shapeDropdown">
                                <button class="dropdown-item" data-shape="line">
                                    <i class="fas fa-minus"></i> 직선
                                </button>
                                <button class="dropdown-item" data-shape="curve">
                                    <i class="fas fa-bezier-curve"></i> 곡선
                                </button>
                                <button class="dropdown-item" data-shape="arrow">
                                    <i class="fas fa-long-arrow-alt-right"></i> 화살표
                                </button>
                                <button class="dropdown-item" data-shape="circle">
                                    <i class="far fa-circle"></i> 원
                                </button>
                                <button class="dropdown-item" data-shape="rect">
                                    <i class="far fa-square"></i> 사각형
                                </button>
                                <button class="dropdown-item" data-shape="arc">
                                    <i class="fas fa-draw-polygon"></i> 원호
                                </button>
                                <button class="dropdown-item" data-shape="dashed">
                                    <i class="fas fa-minus"></i> 점선
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="tool-group">
                        <select id="shapeColorSelect" class="shape-select">
                            <option value="#000000">검정색</option>
                            <option value="#FF0000">빨간색</option>
                            <option value="#0000FF">파란색</option>
                            <option value="#008000">녹색</option>
                            <option value="#800080">보라색</option>
                            <option value="#FFA500">주황색</option>
                        </select>
                        <select id="shapeThicknessSelect" class="shape-select">
                            <option value="1">1px</option>
                            <option value="2" selected>2px</option>
                            <option value="3">3px</option>
                            <option value="4">4px</option>
                            <option value="5">5px</option>
                        </select>
                    </div>
                    <div class="tool-group">
                        <button class="tool-button" data-tool="delete">
                            <i class="fas fa-trash"></i> 삭제
                        </button>
                    </div>
                </div>

                <!-- 장비 배치 도구 -->
                <div id="deviceToolbar" class="toolbar">
                    <div class="tool-group">
                        <button class="tool-button" data-tool="select">
                            <i class="fas fa-mouse-pointer"></i> 선택
                        </button>
                        <button class="tool-button" data-tool="zoom">
                            <i class="fas fa-search-plus"></i> 확대
                        </button>
                    </div>
                </div>

                <!-- 무선AP 관리 도구 -->
                <div id="wirelessToolbar" class="toolbar">
                    <div class="tool-group">
                        <button class="tool-button" data-tool="select">
                            <i class="fas fa-mouse-pointer"></i> 선택
                        </button>
                        <button class="tool-button" data-tool="add-ap">
                            <i class="fas fa-wifi"></i> AP 추가
                        </button>
                        <button class="tool-button" data-tool="remove-ap">
                            <i class="fas fa-trash"></i> AP 삭제
                        </button>
                    </div>
                </div>

                <!-- 캔버스 영역 -->
                <div class="canvas-container">
                    <!-- 미배치 교실 패널 (캔버스 컨테이너 내부로 이동) -->
                    <div class="unplaced-rooms-panel collapsed" id="unplacedRoomsPanel">
                        <div class="panel-header">
                            <h4>미배치 교실</h4>
                        </div>
                        <div class="panel-content" id="unplacedRoomsList">
                            <!-- 미배치 교실 목록이 동적으로 추가됨 -->
                        </div>
                    </div>
                    
                    <!-- 패널 토글 버튼 (패널 바로 옆에 위치) -->
                    <button class="panel-toggle" id="panelToggle">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                    
                    <!-- 확대/축소 컨트롤 (고정 위치) -->
                    <div class="zoom-controls">
                        <button id="zoomIn" class="zoom-btn" title="확대">
                            <i class="fas fa-plus"></i>
                        </button>
                        <span id="zoomLevel">100%</span>
                        <button id="zoomOut" class="zoom-btn" title="축소">
                            <i class="fas fa-minus"></i>
                        </button>
                        <button id="zoomReset" class="zoom-btn" title="원래 크기">
                            <i class="fas fa-expand-arrows-alt"></i>
                        </button>
                    </div>
                    
                    <!-- 캔버스 스크롤 전용 래퍼 -->
                    <div id="canvasWrapper" style="width:100%;height:500px;overflow:auto;position:relative;">
                        <div class="canvas-content" id="canvasContent">
                            <!-- 평면도 요소들이 동적으로 추가됨 -->
                        </div>
                    </div>
                </div>

                <!-- 저장 및 다운로드 -->
                <div class="save-section">
                    <button id="saveButton" class="save-button">
                        <i class="fas fa-save"></i> 평면도 저장
                    </button>
                    <button id="downloadButton" class="download-button">
                        <i class="fas fa-download"></i> PPT 다운로드
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 알림 메시지 -->
    <div id="notification" class="notification">
        <span id="notificationText"></span>
    </div>

    <!-- 다중 선택 정보 -->
    <div id="multiSelectInfo" class="multi-select-info">
        <span id="multiSelectText"></span>
    </div>

    <!-- 교실 상세 모달 포함 -->
    <div th:replace="~{floorplan/classroom-detail-modal :: classroom-detail-modal}"></div>

    <!-- 푸터 포함 -->
    <div th:replace="~{fragments/footer :: footer}"></div>

    <!-- Custom JavaScript for this page -->
    <script type="module" src="/js/floorplan/main.js"></script>
    <script src="/js/floorplan/classroom-modal.js"></script>
</body>
</html> 