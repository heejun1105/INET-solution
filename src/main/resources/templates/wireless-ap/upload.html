<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>무선 AP 엑셀 업로드</title>
    <link rel="stylesheet" href="/main.css">
    <link rel="stylesheet" href="/upload.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div th:replace="~{fragments/navbar :: navbar}"></div>

    <!-- 로딩 오버레이 -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <div class="loading-text">무선 AP 엑셀 파일 업로드 중</div>
            <div class="loading-subtext">잠시만 기다려주세요...</div>
        </div>
    </div>

    <div class="container">
        <div class="upload-container">
            <h2>무선 AP 엑셀 업로드</h2>
            <form th:action="@{/wireless-ap/upload}" method="post" enctype="multipart/form-data" class="upload-form" id="uploadForm">
                <div class="form-group">
                    <label>학교 선택:</label>
                    <select name="schoolId" required>
                        <option value="">학교를 선택하세요</option>
                        <option th:each="school : ${schools}" th:value="${school.schoolId}" th:text="${school.schoolName}"></option>
                    </select>
                </div>
                <div class="form-group">
                    <label>엑셀 파일:</label>
                    <input type="file" name="file" accept=".xls,.xlsx" required>
                </div>
                <button type="submit" id="uploadBtn">업로드</button>
            </form>

            <div th:if="${message}" class="alert alert-success">[[${message}]]</div>
            <div th:if="${error}" class="alert alert-danger">[[${error}]]</div>

            <div class="help-section">
                <h3>엑셀 파일 업로드 도움말</h3>
                <p>업로드 시 다음 사항을 확인해주세요:</p>
                <ul>
                    <li>파일은 .xls 또는 .xlsx 형식이어야 합니다.</li>
                    <li>데이터는 1행부터 시작됩니다.</li>
                    <li><strong>📋 엑셀 데이터 열 순서 (중요!):</strong>
                        <div style="margin-top: 0.5rem; background-color: #f0f9ff; padding: 1rem; border-radius: 6px; border-left: 4px solid #1e3a8a;">
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 0.5rem; font-size: 0.85rem;">
                                <div style="background: white; padding: 0.4rem 0.6rem; border-radius: 4px; border: 1px solid #e2e8f0; display: flex; align-items: center; gap: 0.3rem;">
                                    <span style="background: #dc2626; color: white; border-radius: 50%; width: 18px; height: 18px; display: flex; align-items: center; justify-content: center; font-size: 0.7rem; font-weight: bold;">1</span>
                                    <strong>설치장소</strong> <span style="color: #dc2626;">⭐</span>
                                </div>
                                <div style="background: white; padding: 0.4rem 0.6rem; border-radius: 4px; border: 1px solid #e2e8f0; display: flex; align-items: center; gap: 0.3rem;">
                                    <span style="background: #1e3a8a; color: white; border-radius: 50%; width: 18px; height: 18px; display: flex; align-items: center; justify-content: center; font-size: 0.7rem; font-weight: bold;">2</span>
                                    <strong>새 라벨 번호</strong>
                                </div>
                                <div style="background: white; padding: 0.4rem 0.6rem; border-radius: 4px; border: 1px solid #e2e8f0; display: flex; align-items: center; gap: 0.3rem;">
                                    <span style="background: #1e3a8a; color: white; border-radius: 50%; width: 18px; height: 18px; display: flex; align-items: center; justify-content: center; font-size: 0.7rem; font-weight: bold;">3</span>
                                    <strong>장비 번호</strong>
                                </div>
                                <div style="background: white; padding: 0.4rem 0.6rem; border-radius: 4px; border: 1px solid #e2e8f0; display: flex; align-items: center; gap: 0.3rem;">
                                    <span style="background: #1e3a8a; color: white; border-radius: 50%; width: 18px; height: 18px; display: flex; align-items: center; justify-content: center; font-size: 0.7rem; font-weight: bold;">4</span>
                                    <strong>도입연도</strong>
                                </div>
                                <div style="background: white; padding: 0.4rem 0.6rem; border-radius: 4px; border: 1px solid #e2e8f0; display: flex; align-items: center; gap: 0.3rem;">
                                    <span style="background: #1e3a8a; color: white; border-radius: 50%; width: 18px; height: 18px; display: flex; align-items: center; justify-content: center; font-size: 0.7rem; font-weight: bold;">5</span>
                                    <strong>제조사</strong>
                                </div>
                                <div style="background: white; padding: 0.4rem 0.6rem; border-radius: 4px; border: 1px solid #e2e8f0; display: flex; align-items: center; gap: 0.3rem;">
                                    <span style="background: #1e3a8a; color: white; border-radius: 50%; width: 18px; height: 18px; display: flex; align-items: center; justify-content: center; font-size: 0.7rem; font-weight: bold;">6</span>
                                    <strong>모델명</strong>
                                </div>
                                <div style="background: white; padding: 0.4rem 0.6rem; border-radius: 4px; border: 1px solid #e2e8f0; display: flex; align-items: center; gap: 0.3rem;">
                                    <span style="background: #1e3a8a; color: white; border-radius: 50%; width: 18px; height: 18px; display: flex; align-items: center; justify-content: center; font-size: 0.7rem; font-weight: bold;">7</span>
                                    <strong>MAC 주소</strong>
                                </div>
                                <div style="background: white; padding: 0.4rem 0.6rem; border-radius: 4px; border: 1px solid #e2e8f0; display: flex; align-items: center; gap: 0.3rem;">
                                    <span style="background: #1e3a8a; color: white; border-radius: 50%; width: 18px; height: 18px; display: flex; align-items: center; justify-content: center; font-size: 0.7rem; font-weight: bold;">8</span>
                                    <strong>이전 설치장소</strong>
                                </div>
                                <div style="background: white; padding: 0.4rem 0.6rem; border-radius: 4px; border: 1px solid #e2e8f0; display: flex; align-items: center; gap: 0.3rem;">
                                    <span style="background: #1e3a8a; color: white; border-radius: 50%; width: 18px; height: 18px; display: flex; align-items: center; justify-content: center; font-size: 0.7rem; font-weight: bold;">9</span>
                                    <strong>이전 라벨 번호</strong>
                                </div>
                                <div style="background: white; padding: 0.4rem 0.6rem; border-radius: 4px; border: 1px solid #e2e8f0; display: flex; align-items: center; gap: 0.3rem;">
                                    <span style="background: #1e3a8a; color: white; border-radius: 50%; width: 18px; height: 18px; display: flex; align-items: center; justify-content: center; font-size: 0.7rem; font-weight: bold;">10</span>
                                    <strong>비고</strong>
                                </div>
                            </div>
                        </div>
                    </li>
                    <li>필수 입력 항목: <strong>설치장소(1번째 열)</strong></li>
                    <li>설치장소가 기존에 없는 경우 자동으로 새로 생성됩니다.</li>
                    <li>빈 셀은 null로 처리됩니다.</li>
                </ul>
            </div>
        </div>
    </div>

    <div th:replace="~{fragments/footer :: footer}"></div>

    <script>
        // 폼 업로드 로딩 처리
        document.getElementById('uploadForm').addEventListener('submit', function(e) {
            const fileInput = document.querySelector('input[name="file"]');
            const schoolSelect = document.querySelector('select[name="schoolId"]');
            const loadingOverlay = document.getElementById('loadingOverlay');
            const uploadBtn = document.getElementById('uploadBtn');
            
            // 기본 유효성 검사
            if (!schoolSelect.value) {
                e.preventDefault();
                alert('학교를 선택해주세요.');
                return false;
            }
            
            if (!fileInput.files.length) {
                e.preventDefault();
                alert('업로드할 엑셀 파일을 선택해주세요.');
                return false;
            }
            
            // 파일 확장자 검사
            const fileName = fileInput.files[0].name.toLowerCase();
            if (!fileName.endsWith('.xls') && !fileName.endsWith('.xlsx')) {
                e.preventDefault();
                alert('엑셀 파일(.xls 또는 .xlsx)만 업로드 가능합니다.');
                return false;
            }
            
            // 로딩 상태 활성화
            loadingOverlay.classList.add('active');
            this.classList.add('loading');
            uploadBtn.disabled = true;
            
            // 파일 크기가 클 경우 추가 안내
            const fileSize = fileInput.files[0].size;
            if (fileSize > 5 * 1024 * 1024) { // 5MB 이상
                document.querySelector('.loading-subtext').textContent = '파일이 큽니다. 시간이 더 걸릴 수 있습니다...';
            }
        });
        
        // 페이지 로드 시 로딩 상태 해제 (새로고침 대비)
        window.addEventListener('load', function() {
            const loadingOverlay = document.getElementById('loadingOverlay');
            const uploadForm = document.getElementById('uploadForm');
            const uploadBtn = document.getElementById('uploadBtn');
            
            loadingOverlay.classList.remove('active');
            uploadForm.classList.remove('loading');
            uploadBtn.disabled = false;
        });
    </script>
</body>
</html> 