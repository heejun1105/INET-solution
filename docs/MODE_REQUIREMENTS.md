# 평면도 시스템 - 모드별 요구사항 정리

## 📋 모드 목록

### 설계 모드 (Design Modes)
1. **교실 설계 모드** (`design-classroom`)
2. **무선 AP 설계 모드** (`design-wireless`)
3. **자리 배치 설계 모드** (`design-seat`)

### 보기 모드 (View Modes)
1. **장비 보기 모드** (`view-equipment`)
2. **무선 AP 보기 모드** (`view-wireless`)

### 특수 상태
- **학교만 선택** (모드 미선택 상태)

---

## 🎨 설계 모드 요구사항

### 1. 교실 설계 모드 (`design-classroom`)

#### 표시 조건
- ✅ **교실, 건물, 화장실, 엘리베이터, 도형 등 모든 설계 요소 표시**
- ❌ **무선 AP (`wireless_ap`) 요소 숨김**
- ❌ **MDF/IDF (`mdf_idf`) 요소 숨김**
- ✅ **A4 윤곽선 표시**

#### 기능 조건
- ✅ 요소 생성, 수정, 삭제, 이동, 리사이즈, 회전 가능
- ✅ 새로 생성한 요소는 현재 페이지(`currentPage`)에 `pageNumber` 할당
- ✅ 페이지 전환 시 해당 페이지의 요소만 표시
- ✅ 요소 삭제 시 `localElementsByPage`에 저장하여 페이지 전환 시에도 삭제 상태 유지
- ✅ 저장 시 모든 페이지의 요소를 서버로 전송 (현재 페이지만 저장하지 않음)
- ✅ 저장 시 다른 페이지의 요소가 사라지지 않도록 보존

#### 카메라/뷰 조건
- ✅ 모드 전환 시 이전 모드의 카메라 위치(panX, panY, zoom) 유지
- ✅ 빈 페이지로 이동 후 모드 진입 시 A4 윤곽선 중앙으로 카메라 이동
- ✅ `fitToElements()` 호출 시 A4 윤곽선 중앙 기준으로 카메라 조정

---

### 2. 무선 AP 설계 모드 (`design-wireless`)

#### 표시 조건
- ✅ **교실 요소 표시** (AP 배치를 위한 기준)
- ✅ **무선 AP (`wireless_ap`) 요소 표시 및 편집 가능**
- ✅ **MDF/IDF (`mdf_idf`) 요소 표시 및 편집 가능**
- ✅ **A4 윤곽선 표시**

#### 기능 조건
- ✅ AP 종류 변경 가능 (원형, 삼각형, 사각형, 원형L 등)
- ✅ AP 색상 변경 가능 (배경색, 테두리색, 글자색)
- ✅ AP 위치 이동 가능 (교실 내부로 제한)
- ✅ AP는 교실 밖으로 나갈 수 없음 (드래그 경계 체크)
- ✅ AP 위치는 교실 기준 상대 좌표(offset)로 저장
- ✅ AP 변경 사항은 `savedApPositions`에 저장되어 모드 전환 시에도 유지
- ✅ 페이지 전환 시 해당 페이지의 AP만 표시
- ✅ 페이지 전환 시 서버에서 저장된 AP 위치 다시 로드

#### 데이터 관리 조건
- ✅ AP 변경 사항은 `FloorPlanApp` 레벨의 `savedApPositions`에 저장
- ✅ 교실 설계 모드에서 저장 후에도 AP 변경 사항 유지
- ✅ 서버에서 로드한 AP 데이터와 로컬 변경 사항 병합 (로컬 우선)

---

### 3. 자리 배치 설계 모드 (`design-seat`)

#### 표시 조건
- ✅ **교실 요소 표시**
- ✅ **자리 배치 관련 요소 표시**
- ✅ **A4 윤곽선 표시**

#### 기능 조건
- ✅ 자리 배치 설계 기능
- ✅ 페이지 전환 시 해당 페이지의 요소만 표시

---

## 👁️ 보기 모드 요구사항

### 1. 장비 보기 모드 (`view-equipment`)

#### 표시 조건
- ✅ **교실 요소 표시**
- ✅ **장비 정보 카드 (`equipment_card`) 표시**
- ❌ **무선 AP (`wireless_ap`) 요소 숨김**
- ❌ **MDF/IDF (`mdf_idf`) 요소 숨김**
- ✅ **A4 윤곽선 표시**

#### 기능 조건
- ✅ 모든 요소 잠금 (읽기 전용)
- ✅ 페이지 전환 시 해당 페이지의 교실만 표시
- ✅ 페이지 전환 시 해당 페이지의 장비 정보만 표시
- ✅ 페이지 전환 시 `loadDevices()` 호출하여 장비 데이터 로드
- ✅ 페이지 전환 시 `renderEquipmentCards()` 호출하여 장비 카드 렌더링
- ✅ 장비 정보는 교실 내부에 텍스트 형태로 표시 (예: "DW 1, MO 1, TV 1")

#### 카메라/뷰 조건
- ✅ 모드 전환 시 이전 모드의 카메라 위치 유지
- ✅ `fitToElements()` 호출하지 않음 (카메라 위치 보존)

---

### 2. 무선 AP 보기 모드 (`view-wireless`)

#### 표시 조건
- ✅ **교실 요소 표시**
- ✅ **무선 AP (`wireless_ap`) 요소 표시**
- ✅ **MDF/IDF (`mdf_idf`) 요소 표시**
- ❌ **장비 정보 카드 숨김**
- ✅ **A4 윤곽선 표시**

#### 기능 조건
- ✅ 모든 요소 잠금 (읽기 전용)
- ✅ 페이지 전환 시 해당 페이지의 교실만 표시
- ✅ 페이지 전환 시 해당 페이지의 AP만 표시
- ✅ 페이지 전환 시 `loadSavedApMdfElements()` 호출하여 AP 위치 로드
- ✅ 페이지 전환 시 `renderWirelessAps()` 호출하여 AP 렌더링
- ✅ AP 위치는 설계 모드와 동일하게 표시 (일관성 유지)

#### 카메라/뷰 조건
- ✅ 모드 전환 시 이전 모드의 카메라 위치 유지
- ✅ `fitToElements()` 호출하지 않음 (카메라 위치 보존)

---

## 🏫 학교만 선택 상태 (모드 미선택)

#### 표시 조건
- ✅ **교실, 건물, 화장실, 엘리베이터, 도형 등 설계 요소 표시**
- ❌ **무선 AP (`wireless_ap`) 요소 숨김**
- ❌ **MDF/IDF (`mdf_idf`) 요소 숨김**
- ❌ **장비 정보 카드 숨김**

#### 기능 조건
- ✅ 평면도 로드 및 기본 표시
- ✅ AP 설계 모드에서 다른 페이지 수정 후 돌아와도 AP가 복제되지 않음
- ✅ AP는 AP 설계 모드에서만 표시되어야 함

---

## 🔄 공통 요구사항

### 페이지 관리
- ✅ 페이지 전환 시 `core.currentPage` 업데이트
- ✅ 페이지 전환 시 `window.floorPlanApp.currentPage` 업데이트
- ✅ 페이지 전환 시 해당 페이지의 요소만 필터링하여 표시
- ✅ `pageNumber`가 `null` 또는 `undefined`인 요소는 1페이지로 간주
- ✅ 새로 생성한 요소는 현재 페이지에 `pageNumber` 할당

### 데이터 동기화
- ✅ 저장 시 모든 페이지의 요소를 서버로 전송
- ✅ 저장 시 현재 페이지(`currentPage`) 정보도 함께 전송
- ✅ 서버는 현재 페이지의 요소만 삭제 후 전체 요소 저장
- ✅ 다른 페이지의 요소는 보존됨

### 카메라/뷰 관리
- ✅ 모드 전환 시 카메라 위치(panX, panY, zoom) 유지
- ✅ `fitToElements()` 호출 시 A4 윤곽선 중앙 기준으로 조정
- ✅ 빈 페이지에서 모드 진입 시 A4 윤곽선 중앙으로 이동

### 요소 필터링
- ✅ `FloorPlanCore.renderElements()`에서 모드별 필터링
- ✅ 설계 모드: AP/MDF 숨김
- ✅ 장비 보기 모드: AP/MDF 숨김
- ✅ AP 보기 모드: 장비 카드 숨김

### 로컬 변경사항 관리
- ✅ `localElementsByPage`에 페이지별 로컬 변경사항 저장
- ✅ 페이지 전환 시 로컬 변경사항 우선 적용
- ✅ 삭제된 요소는 로컬에 빈 배열로 저장하여 서버 데이터 로드 방지

---

## 📝 특수 케이스

### AP 위치 관리
- ✅ AP 위치는 교실 기준 상대 좌표(offset)로 저장
- ✅ 서버에는 절대 좌표로 저장 (저장 시 변환)
- ✅ 로드 시 절대 좌표를 상대 좌표로 변환
- ✅ 모든 페이지의 교실을 검색하여 부모 교실 찾기

### AP 변경사항 보존
- ✅ `savedApPositions`는 `FloorPlanApp` 레벨에서 관리
- ✅ 모드 전환 시에도 AP 변경사항 유지
- ✅ 서버 데이터와 로컬 변경사항 병합 (로컬 우선)

### 페이지 전환 시 데이터 로드
- ✅ 장비 보기 모드: `loadDevices()` → `renderEquipmentCards()`
- ✅ AP 보기 모드: `loadSavedApMdfElements()` → `renderWirelessAps()`
- ✅ AP 설계 모드: `loadSavedApMdfElements()` → `renderWirelessAps()`

---

## ✅ 검증 체크리스트

### 교실 설계 모드
- [ ] AP가 보이지 않는가?
- [ ] 새 요소 생성 시 현재 페이지에 할당되는가?
- [ ] 페이지 전환 시 해당 페이지 요소만 보이는가?
- [ ] 요소 삭제 후 페이지 전환해도 삭제 상태가 유지되는가?
- [ ] 저장 시 다른 페이지 요소가 사라지지 않는가?
- [ ] 모드 전환 시 카메라 위치가 유지되는가?

### 무선 AP 설계 모드
- [ ] AP가 보이는가?
- [ ] AP 종류/색상 변경이 가능한가?
- [ ] AP 위치 이동이 가능한가?
- [ ] AP가 교실 밖으로 나갈 수 없는가?
- [ ] 페이지 전환 시 해당 페이지 AP만 보이는가?
- [ ] AP 변경사항이 모드 전환 후에도 유지되는가?

### 장비 보기 모드
- [ ] 장비 정보가 표시되는가?
- [ ] AP가 보이지 않는가?
- [ ] 페이지 전환 시 해당 페이지 장비만 보이는가?
- [ ] 모드 전환 시 카메라 위치가 유지되는가?

### 무선 AP 보기 모드
- [ ] AP가 표시되는가?
- [ ] 장비 정보가 보이지 않는가?
- [ ] 페이지 전환 시 해당 페이지 AP만 보이는가?
- [ ] AP 위치가 설계 모드와 동일한가?
- [ ] 모드 전환 시 카메라 위치가 유지되는가?

### 학교만 선택 상태
- [ ] AP가 보이지 않는가?
- [ ] 기본 설계 요소만 보이는가?
- [ ] AP 복제 현상이 없는가?

